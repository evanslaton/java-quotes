import com.google.gson.Gson;

import javax.imageio.ImageIO;
import java.io.*;
import java.net.HttpURLConnection;
import java.net.URL;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.stream.Collectors;

/*
 * This Java source file was generated by the Gradle 'init' task.
 */
public class App {
    public static void main(String[] args) {
        // Get internet quote and save to file / get file quote if error
        try {
            // Gets and prints internet quote to the console
            InternetQuoteGetter internetQuoteGetter = new InternetQuoteGetter();
            Quote randomQuote = internetQuoteGetter.getInternetQuote();
            System.out.println(randomQuote.toString());

            // Gets file quotes
            FileQuoteGetter fileQuoteGetter = new FileQuoteGetter();
            Path file = Paths.get("./resources/recentquotes.json");
            Quote[] quotes = fileQuoteGetter.getFileQuotes(file);

            // Create a new array and adds the file quotes and internet quotes to it
            Quote[] toSave = new Quote[quotes.length + 1];
            for (int i = 0; i < quotes.length; i++) {
                toSave[i] = quotes[i];
            }
            toSave[toSave.length - 1] = randomQuote;

            // Turns into json
            Gson gson = new Gson();
            String save = gson.toJson(toSave);

            //Saves quotes
            try {
                FileWriter fileWriter = new FileWriter("./resources/recentquotes.json");
                fileWriter.write(save);
                fileWriter.close();
            } catch (IOException error) {
                System.out.println("Quote not saved");
            }
        } catch (IOException error) {
            System.out.println("Error: " + error);
            try {
                FileQuoteGetter fileQuoteGetter = new FileQuoteGetter();
                Path file = Paths.get("./resources/recentquotes.json");
                Quote quote = fileQuoteGetter.getRandomQuote(file);
                System.out.println(quote.toString());
            } catch(IOException otherError) {
                System.out.println("Something has gone terribly wrong.");
            }
        }

    }
}
